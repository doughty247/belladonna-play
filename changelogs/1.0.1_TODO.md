# Belladonna 1.0.1 TODO / Planning

Release Target: 2025-09-21
Status Legend: [ ] pending, [WIP] in progress, [DONE] complete

## Core Hardening
- [DONE] CLOCK MONOTONIC Enforcement: Replace wall-clock in replay guard & sampling with monotonic; add skew detection at startup (warn if >2s delta).
- [DONE] Config Hash TOCTOU: Recompute policy hash after sandbox (seccomp + landlock if enabled) compile; fail if mismatch from pre-apply hash.
- [DONE] Audit Log Crash Consistency: Implement recovery scanner + durable append (fsync + chain rebuild & truncation). (Implemented: recovery on first write, tail truncation, sync_data after each JSON entry.)

## Key & Secret Lifecycle
- [DONE] Zero-Length / Partial Key File Detection test + refusal.
- [DONE] Key Epoch Monotonicity: store epoch marker; refuse loading older key on rotate.
- [DONE] Optional TPM/KEK wrapping (feature `belladonna_tpm_real`).

## Replay & Nonce Enhancements
- [DONE] Property tests (quickcheck/proptest) for eviction invariants under jitter.
- [DONE] Namespaced nonce sets (configurable isolation domain) â€“ groundwork for multi-tenant.

## Policy Governance
- [DONE] Segment Hashes: Separate auth_hash, rate_hash, sandbox_hash, decoy_hash metrics & drift labeling.
- [DONE] Policy Diff CLI: `dev policy-diff a.toml b.toml` with effective privilege change summary.

## Incident Response
- [DONE] Signed Approval Tokens (Ed25519) with nonce + expiry; verify chain.
- [DONE] Unfreeze Token Replay Prevention: maintain short-term used token bloom / set.

## Decoy / Hydra / Haze
- [DONE] Adaptive decoy threshold auto-tuning using recent 95th percentile decoy rate.
- [DONE] Hydra Score Metrics: percentile export + invariants tests.

## Observability & Telemetry
- [DONE] Span-level tracing: command lifecycle (recv -> auth -> validate -> exec -> sandbox -> complete).
- [DONE] Add metrics: decision_latency_ms histogram, audit_backlog_depth, replay_eviction_rate.
- [DONE] OTLP exporter health probe & metric `otel_export_errors_total`.

## Config Lint & CI
- [DONE] Severity tiers (ERROR/WARN/INFO) with counts surfaced as metrics.
- [DONE] CI gate additions: cargo clippy -D warnings, cargo deny, cargo audit, SBOM generation, policy hash gating matrix.
- [DONE] Provide example GitHub Actions workflow.

## Supply Chain & Build Integrity
- [DONE] SBOM (CycloneDX) generation script + inclusion in release artifacts.
- [DONE] Sigstore (cosign) artifact attestation script.
- [DONE] Integrate `cargo deny` and `cargo vet` policies.

## Testing & Fuzzing
- [DONE] Fuzz targets: config parser, audit log parser, policy diff.
- [DONE] Fault injection: simulate fsync ENOSPC and ensure graceful degrade.
- [DONE] Kernel matrix CI for seccomp/landlock regression detection.

## Performance & SLOs
- [DONE] P95/P99 latency benchmarks recorded; add tail amplification test harness.
- [DONE] Draft SLO doc (P99 <50ms @ 2x load) + error budget loop.

## Documentation
- [DONE] Disaster recovery runbook (key loss, audit corruption, frozen mode).
- [DONE] Quickstart 5-minute deploy with Prometheus + OTLP.
- [DONE] Grafana dashboard JSON examples.

## Nice-to-Have (Stretch)
- [DONE] Auto parameter tuner (decoy & sampling) feedback loop.
- [DONE] Landlock integration (if not already) with policy version metric.

## Tracking Metrics After 1.0.1
- [DONE] Reduction in manual unfreeze events.
- [DONE] Stable replay eviction rate (<2% normal load).
- [DONE] Drift events categorization accuracy.

## Exit Criteria
All Core Hardening + Key & Secret Lifecycle + Config Lint & CI + Observability (metrics + spans) tasks complete with passing CI and zero warnings.
