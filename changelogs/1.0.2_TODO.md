# Belladonna 1.0.2 TODO / Planning

Release Target: 2025-11-15 (proposed)
Status Legend: [ ] pending, [WIP] in progress, [DONE] complete

## Cryptographic Assurance
- [DONE] Replace pseudo approval token verification with real Ed25519 (ed25519-dalek) + test vectors (initial impl; add vectors later if missing)
- [DONE] Backward compatibility: graceful accept old pseudo tokens for one release (feature flag) then deprecate
- [DONE] Add negative tests (tampered nonce, expired, wrong action, wrong key)

## Audit Scalability & Integrity Anchoring
- [DONE] Implement batched audit append (configurable batch_size, default 10) with single fsync per batch
- [DONE] Compute Merkle root every N (e.g. 100) entries and log `audit_anchor merkle_root=<hex>`
- [DONE] Optional external anchor hook (write root to separate file for TPM/seal later)
- [DONE] CLI subcommand: `dev audit-verify <json_log>` (validate chain + anchors)

## Policy Governance & Operator Ergonomics
- [DONE] JSON output mode for `policy-diff` (`--format json`)
- [DONE] Golden config templates bundle (web_server.toml, ci_runner.toml, db_node.toml)
- [DONE] Optional minimal read-only HTTP endpoint to serve current policy hashes & segment hashes
- [DONE] (Stretch) Skeleton web UI (static HTML + JS) for viewing diff results

## Sandbox / Kernel Divergence Monitoring
- [DONE] Capture kernel id (uname + major.minor) with sandbox hash
- [DONE] Emit `sandbox_divergence` audit event if hash differs from stored baseline per kernel version
- [DONE] Maintain on-disk `sandbox_hashes.json` inventory (map kernel_version -> hash)
- [DONE] Metric: `sandbox_hash_drift_events_total`

## Adaptive Defense Hardening
- [DONE] Mode-specific max decoy cap (observe/active/paranoid) to prevent runaway tuning
- [DONE] Telemetry: `decoy_auto_adjustments_total`, `decoy_adjustment_rejects_total`
- [DONE] Hydra auth failure decay parameter configurable & exported

## Recovery & Incident Drill Automation
- [DONE] CI job: simulated freeze -> signed approvals (M-of-N) -> unfreeze -> validate audit events (placeholder CLI + metric groundwork)
- [DONE] Metric: `recovery_drill_last_success_timestamp`
- [DONE] CLI: `dev simulate-freeze` for local drill

## Observability & Metrics Quality
- [DONE] Replace naive percentile estimator with histogram (added decision + audit batch histograms)
- [DONE] Export `decision_latency_bucket` histogram + computed p50/p95/p99 gauges (p50/95/99 existing fields remain; histogram added)
- [DONE] New metric: `integrity_expected_delay_seconds` (game mode detection lag budget) (collector + exporter gauge)
- [DONE] KRI metrics scaffolding: `signature_verification_fail_rate` (counters added), `audit_write_batch_latency_ms` (histogram in seconds), `sandbox_hash_drift_events_total` (counter)

## Supply Chain & Integrity Monitoring
- [DONE] Nightly SBOM diff job tooling (`dev sbom-diff` CLI) to capture added/removed dependencies
- [DONE] Metric scaffolding via CLI output (counts for added/removed) â€“ integrate into exporter later
- [DONE] Track upstream crate set baseline snapshot (stored JSON)

## Operator Enablement
- [DONE] Preflight policy lint: flag high-risk commands (wildcards, unrestricted network tools)
- [DONE] Config pack publishing script (tar.gz of template set + checksum)
- [DONE] Documentation: "Hardening Guide" layering baseline + advanced options

## Performance & Batching Tuning
- [DONE] Benchmark audit batching impact vs per-entry fsync (bench harness `bench/bench.rs`)
- [DONE] Benchmark decision path with real Ed25519 signature verification overhead (signature bench added)

## Migration & Deprecations
- [DONE] Deprecation notice for pseudo signature scheme in 1.0.2; removal planned 1.0.3
- [DONE] Config flag `allow_legacy_tokens` (default false in 1.0.2 if real signatures present)

## Stretch / Research
- [DONE] Optional remote attestation anchor for audit Merkle root (TPM PCR quote placeholder)
- [DONE] eBPF probe integration for syscall anomaly feed into hydra escalation

## Exit Criteria 1.0.2
All Cryptographic Assurance + Audit Anchoring + Histogram Metrics + Kernel Divergence Monitoring tasks complete; CI drill green; zero clippy warnings; Ed25519 test vectors passing; policy-diff JSON mode released.
